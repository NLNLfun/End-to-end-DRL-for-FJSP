# 安装和使用指南

## 环境配置

### Python环境要求
- Python 3.6+
- 推荐使用Anaconda或虚拟环境

### 依赖包安装

```bash
# 创建虚拟环境（推荐）
conda create -n fjsp-drl python=3.8
conda activate fjsp-drl

# 安装PyTorch (根据你的CUDA版本选择合适的安装命令)
# CPU版本：
conda install pytorch torchvision torchaudio cpuonly -c pytorch

# GPU版本（CUDA 11.x）：
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia

# 安装其他依赖
pip install numpy matplotlib gym
```

## 快速开始

### 1. 训练模型

```bash
cd FJSP_MultiPPO
python PPOwithValue.py
```

**训练参数说明**：
- 默认问题规模：30个作业，20台机器
- 训练实例数：12800个
- 最大更新次数：10000次
- 学习率：0.001

可以通过修改 `Params.py` 文件调整这些参数。

### 2. 验证模型

#### 随机实例验证：
```bash
cd FJSP_MultiPPO
python validation.py
```

#### 标准基准实例验证：
```bash
cd FJSP_RealWorld
python validation_realWorld.py
```

## 参数配置

### 主要参数文件：`Params.py`

#### 环境参数：
- `n_j`: 作业数量（默认：30）
- `n_m`: 机器数量（默认：20）
- `device`: 计算设备（'cuda' 或 'cpu'）

#### 网络参数：
- `hidden_dim`: 隐藏层维度（默认：128）
- `num_layers`: GNN层数（默认：3）
- `graph_pool_type`: 图池化类型（默认：'average'）

#### 训练参数：
- `lr`: 学习率（默认：0.001）
- `batch_size`: 批次大小（默认：128）
- `max_updates`: 最大更新次数（默认：10000）

## 输出结果说明

### 训练过程输出：
- `Episode`: 当前训练轮次
- `Reward`: 当前奖励值
- `Loss`: 网络损失值
- `C_max`: 最大完工时间（调度目标）

### 验证结果：
- 显示每个测试实例的调度结果
- 平均性能指标
- 与基准方法的性能对比

## 常见问题

### Q1: CUDA相关错误
**问题**: 出现CUDA内存不足或版本不匹配错误
**解决**: 
1. 检查CUDA版本兼容性
2. 在 `Params.py` 中设置 `device='cpu'`
3. 减小批次大小 `batch_size`

### Q2: 训练速度慢
**问题**: 训练过程耗时过长
**解决**:
1. 使用GPU加速（设置 `device='cuda'`）
2. 减少实例数量 `num_ins`
3. 减少问题规模 `n_j`, `n_m`

### Q3: 内存不足
**问题**: 内存占用过高
**解决**:
1. 减小批次大小 `batch_size`
2. 减少网络隐藏层维度 `hidden_dim`
3. 减少GNN层数 `num_layers`

## 自定义使用

### 修改问题规模：
```python
# 在 Params.py 中修改
parser.add_argument('--n_j', type=int, default=20, help='作业数')
parser.add_argument('--n_m', type=int, default=15, help='机器数')
```

### 添加新的基准实例：
1. 将实例文件放入 `FJSP_RealWorld/FJSSPinstances/` 目录
2. 修改 `DataRead.py` 中的文件路径
3. 运行 `validation_realWorld.py`

### 调整网络结构：
```python
# 在 Params.py 中修改网络参数
parser.add_argument('--hidden_dim', type=int, default=256, help='隐藏层维度')
parser.add_argument('--num_layers', type=int, default=4, help='GNN层数')
```

## 性能优化建议

1. **使用GPU加速**: 确保安装CUDA版本的PyTorch
2. **调整批次大小**: 根据内存大小调整 `batch_size`
3. **预训练模型**: 使用 `saved_network/` 中的预训练模型
4. **参数调优**: 根据具体问题调整学习率和网络参数

## 结果可视化

系统支持甘特图可视化调度结果：
- 训练过程中会生成调度方案的甘特图
- 保存在 `FJSP_FIGURE/` 目录下
- 可以直观查看作业在各机器上的调度情况

## 技术支持

如遇问题，建议：
1. 检查Python环境和依赖包版本
2. 查看错误日志详细信息
3. 联系作者：kunlei@my.swjtu.edu.cn